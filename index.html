<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø°ÙƒÙŠ - LINK EXPERT</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
:root { --primary: #c7a35a; --secondary: #2c3e50; }
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f4f9; padding: 20px; margin: 0; }

/* ØªØµÙ…ÙŠÙ… Ø§Ù„ÙˆØ±Ù‚Ø© */
.page { 
    width: 210mm; 
    min-height: 297mm; 
    margin: 0 auto; 
    background: #fff; 
    padding: 10mm; 
    box-shadow: 0 0 20px rgba(0,0,0,0.1);
    position: relative;
}

/* Ø§Ù„Ù‡ÙŠØ¯Ø± */
.header { display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid var(--primary); padding-bottom: 10px; margin-bottom: 15px; }
.header img { height: 60px; object-fit: contain; }
.header-center { text-align: center; }
.header-center h2 { margin: 0; font-size: 18px; color: var(--secondary); }
.date-display { font-size: 14px; margin-top: 5px; color: #555; }

/* Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
table { width: 100%; border-collapse: collapse; margin-bottom: 10px; font-size: 12px; }
th, td { border: 1px solid #ddd; padding: 6px; text-align: center; }
th { background-color: #f8f9fa; color: var(--secondary); font-weight: bold; }

/* Ø£Ù„ÙˆØ§Ù† Ø§Ù„ÙØªØ±Ø§Øª */
.morning th { background: #fff3cd !important; border-color: #ffeeba; }
.evening th { background: #d1ecf1 !important; border-color: #bee5eb; }

/* Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
td.name { background: #fff; cursor: text; transition: background 0.2s; }
td.name:focus { background: #e8f0fe; outline: none; }
tr.filled-morning { background: #fff8e1; }
tr.filled-evening { background: #e0f7fa; }

/* Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª */
.count-badge { background: var(--secondary); color: #fff; padding: 2px 8px; border-radius: 4px; font-size: 11px; }

/* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Ù„Ø§ ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©) */
.controls {
    position: fixed; left: 20px; top: 50%; transform: translateY(-50%);
    background: #fff; padding: 15px; border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2); display: flex; flex-direction: column; gap: 10px;
    z-index: 1000;
}
.btn {
    padding: 10px 15px; border: none; border-radius: 6px;
    font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px;
    transition: transform 0.2s;
}
.btn:hover { transform: scale(1.05); }
.btn-pdf { background: #dc3545; color: white; }
.btn-excel { background: #28a745; color: white; }
.btn-clear { background: #6c757d; color: white; }

/* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¹Ù†Ø¯ Ø§Ù„ØªØµØ¯ÙŠØ± */
.no-print { display: none; }

/* Ø§Ù„ØªÙˆØ§Ù‚ÙŠØ¹ ÙˆØ§Ù„Ù…Ù„Ø®Øµ */
.summary-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 15px 0; }
.summary-box { border: 1px solid #ccc; padding: 5px; text-align: center; border-radius: 4px; }
.footer { display: flex; justify-content: space-between; margin-top: 20px; }
.signature-box { width: 40%; border-top: 1px solid #000; padding-top: 5px; text-align: center; margin-top: 30px; font-weight: bold; }

</style>
</head>
<body>

<div class="controls" data-html2canvas-ignore="true">
    <div style="text-align:center; margin-bottom:5px; font-weight:bold;">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
    <input type="date" id="dateInput" onchange="updateDate()" style="padding:8px; border:1px solid #ccc; border-radius:5px;">
    <button class="btn btn-pdf" onclick="generatePDF()">ğŸ“„ Ø­ÙØ¸ ÙƒÙ€ PDF</button>
    <button class="btn btn-excel" onclick="exportExcel()">ğŸ“Š Ø­ÙØ¸ ÙƒÙ€ Excel</button>
    <button class="btn btn-clear" onclick="clearData()">ğŸ”„ ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯</button>
    <div id="saveStatus" style="font-size:10px; color:green; text-align:center;">ØªÙ… Ø§Ù„Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ âœ…</div>
</div>

<div class="page" id="reportPage">
    <div class="header">
        <img src="majdoul.png" alt="Majdoul"> <div class="header-center">
            <h2>LINK EXPERT COMPANY</h2>
            <div>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</div>
            <div class="date-display" id="dateDisplay">--/--/----</div>
        </div>
        <img src="linkexpert.png" alt="LinkExpert">
    </div>

    <table class="morning">
        <thead><tr><th width="5%">#</th><th width="35%">Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</th><th>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</th><th width="15%">Ø§Ù„ØªÙˆÙ‚ÙŠØª</th></tr></thead>
        <tbody id="morningBody"></tbody>
        <tfoot><tr><td colspan="3" style="text-align:left; font-weight:bold; padding-left:10px;">Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ (ØµØ¨Ø§Ø­):</td><td class="count-badge" id="cntM">0</td></tr></tfoot>
    </table>

    <table class="evening">
        <thead><tr><th width="5%">#</th><th width="35%">Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</th><th>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</th><th width="15%">Ø§Ù„ØªÙˆÙ‚ÙŠØª</th></tr></thead>
        <tbody id="eveningBody"></tbody>
        <tfoot><tr><td colspan="3" style="text-align:left; font-weight:bold; padding-left:10px;">Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ (Ù…Ø³Ø§Ø¡):</td><td class="count-badge" id="cntE">0</td></tr></tfoot>
    </table>

    <div class="summary-grid">
        <div class="summary-box">ØµØ¨Ø§Ø­ <br> <span id="sm">0 / 19</span></div>
        <div class="summary-box">Ù…Ø³Ø§Ø¡ <br> <span id="se">0 / 9</span></div>
        <div class="summary-box">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ <br> <span id="st">0 / 28</span></div>
    </div>

    <div class="footer">
        <div class="signature-box">Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©<br>Ø³Ù„Ù…Ø§Ù† Ø§Ù„Ø­Ù…ÙˆØ¯</div>
        <div class="signature-box">Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹<br>Ø³Ø§Ù„Ù… Ø§Ù„Ø´Ù…Ø±ÙŠ</div>
    </div>
</div>

<script>
const morningJobs = ["Ù…Ø¯ÙŠØ± Ø§Ù„Ù…ÙˆØ§Ù‚Ù","ØªØºØ·ÙŠØ§Øª","ØªØºØ·ÙŠØ§Øª","ÙØ§Ù„ÙŠÙ‡ 1","ÙØ§Ù„ÙŠÙ‡ 1","ÙØ§Ù„ÙŠÙ‡ 2","ÙØ§Ù„ÙŠÙ‡ 3 - ÙØ­Øµ","Ù…Ù†Ø¸Ù… Ø¨ÙˆØ§Ø¨Ø© 3","Ù…Ù†Ø¸Ù… Ø¨ÙˆØ§Ø¨Ø© 5","Ù…Ù†Ø¸Ù… Ù…ÙˆØ§Ù‚Ù P1","Ù…Ù†Ø¸Ù… Ù…ÙˆØ§Ù‚Ù P1","Ù…Ù†Ø¸Ù… Ù…ÙˆØ§Ù‚Ù P1","Ù…Ù†Ø¸Ù… Ù…ÙˆØ§Ù‚Ù P2","Ù…Ù†Ø¸Ù… Ù…ÙˆØ§Ù‚Ù P2","Ù…Ù†Ø¸Ù… Ù…ÙˆØ§Ù‚Ù P2","Ù…Ù†Ø¸Ù… Ù…ÙˆØ§Ù‚Ù P3","Ù…Ù†Ø¸Ù… Ù…ÙˆØ§Ù‚Ù P4","Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø´Ø­Ù† A","Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø´Ø­Ù† P2"];
const eveningJobs = ["ØªØºØ·ÙŠØ§Øª","ÙØ§Ù„ÙŠÙ‡ 1","ÙØ§Ù„ÙŠÙ‡ 2","Ù…Ù†Ø¸Ù… Ø¨ÙˆØ§Ø¨Ø© 3","Ù…Ù†Ø¸Ù… Ø¨ÙˆØ§Ø¨Ø© 5","Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø´Ø­Ù† A","Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø´Ø­Ù† P2","Ù…Ù†Ø¸Ù… Ù…ÙˆØ§Ù‚Ù P1","Ù…Ù†Ø¸Ù… Ù…ÙˆØ§Ù‚Ù P3"];

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
window.onload = function() {
    renderTable('morningBody', morningJobs, 'morning');
    renderTable('eveningBody', eveningJobs, 'evening');
    loadData(); // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
    updateDate();
};

function renderTable(id, jobs, type) {
    const tbody = document.getElementById(id);
    tbody.innerHTML = jobs.map((job, i) => `
        <tr class="row-${type}">
            <td>${i + 1}</td>
            <td>${job}</td>
            <td class="name" contenteditable="true" oninput="saveData(this, '${type}')" data-id="${type}-${i}"></td>
            <td>${type === 'morning' ? '7Øµ - 7Ù…' : '7Ù… - 7Øµ'}</td>
        </tr>
    `).join('');
}

// 1. Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ (Ù…ÙŠØ²Ø© Pro)
function saveData(cell, type) {
    const row = cell.parentElement;
    const val = cell.innerText.trim();
    
    // ØªÙ„ÙˆÙŠÙ† Ø§Ù„ØµÙ
    if(val) row.classList.add(type === 'morning' ? 'filled-morning' : 'filled-evening');
    else row.classList.remove('filled-morning', 'filled-evening');

    // Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…ØªØµÙØ­
    const id = cell.getAttribute('data-id');
    localStorage.setItem(id, val);

    calc();
}

// Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
function loadData() {
    document.querySelectorAll('.name').forEach(cell => {
        const id = cell.getAttribute('data-id');
        const saved = localStorage.getItem(id);
        if(saved) {
            cell.innerText = saved;
            const type = id.split('-')[0];
            cell.parentElement.classList.add(type === 'morning' ? 'filled-morning' : 'filled-evening');
        }
    });
    const savedDate = localStorage.getItem('savedDate');
    if(savedDate) document.getElementById('dateInput').value = savedDate;
    calc();
}

function updateDate() {
    const input = document.getElementById("dateInput");
    const display = document.getElementById("dateDisplay");
    if(input.value) {
        const d = new Date(input.value);
        display.innerText = d.toLocaleDateString('ar-SA', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        localStorage.setItem('savedDate', input.value);
    }
}

function calc() {
    const m = document.querySelectorAll('.filled-morning').length;
    const e = document.querySelectorAll('.filled-evening').length;
    document.getElementById('cntM').innerText = m;
    document.getElementById('cntE').innerText = e;
    document.getElementById('sm').innerText = `${m} / 19`;
    document.getElementById('se').innerText = `${e} / 9`;
    document.getElementById('st').innerText = `${m+e} / 28`;
}

// Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ÙŠÙˆÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯
function clearData() {
    if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ù„Ø¨Ø¯Ø¡ ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯ØŸ")) {
        localStorage.clear();
        location.reload();
    }
}

// 2. Ø§Ù„ØªØµØ¯ÙŠØ± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… html2pdf (Ù…ÙŠØ²Ø© Pro)
function generatePDF() {
    const element = document.getElementById('reportPage');
    const opt = {
        margin:       0,
        filename:     `Ø­Ø¶ÙˆØ±_${new Date().toISOString().slice(0,10)}.pdf`,
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2 },
        jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
    };
    // Ù…ÙƒØªØ¨Ø© ØªÙ‚ÙˆÙ… Ø¨ØªØµÙˆÙŠØ± Ø§Ù„ØµÙØ­Ø© ÙˆØªØ­ÙˆÙŠÙ„Ù‡Ø§ Ù„Ù€ PDF
    html2pdf().set(opt).from(element).save();
}

// 3. ØªØµØ¯ÙŠØ± Excel Ù…Ø­Ø³Ù‘Ù†
function exportExcel() {
    let csv = "\ufeffØ§Ù„Ù…Ø³Ù…Ù‰,Ø§Ù„Ø§Ø³Ù…,Ø§Ù„ÙØªØ±Ø©\n";
    document.querySelectorAll("tr").forEach(tr => {
        const nameCell = tr.querySelector('.name');
        if(nameCell && nameCell.innerText.trim()) {
            const cols = tr.querySelectorAll('td');
            csv += `"${cols[1].innerText}","${nameCell.innerText}","${cols[3].innerText}"\n`;
        }
    });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(new Blob([csv], {type: "text/csv;charset=utf-8"}));
    link.download = "Ø¬Ø¯ÙˆÙ„_Ø§Ù„Ø­Ø¶ÙˆØ±.csv";
    link.click();
}
</script>

</body>
</html>
