<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø§Ù„ØªØ­Ø¶ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</title>

<style>
@page { size: A4; margin: 8mm; }

/* ===== Ù‡ÙŠÙƒÙ„ Ø§Ù„ØµÙØ­Ø© ===== */
html, body {
    height: 100%;
    margin: 0;
}

body {
    font-family: "Tahoma","Arial","Segoe UI",sans-serif;
    display: grid;
    grid-template-rows: auto 1fr auto; /* header | content | footer */
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
}

/* ===== Ø§Ù„Ù‡ÙŠØ¯Ø± ===== */
.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.logo-box img {
    height: 75px;
}

/* ===== Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ===== */
h2 {
    text-align: center;
    margin: 2px 0;
    font-size: 15px;
    font-weight: bold;
}

h3 {
    text-align: center;
    margin: 2px 0;
    font-size: 11px;
    font-weight: bold;
}

.date {
    text-align: center;
    font-weight: bold;
    font-size: 11px;
    margin-bottom: 3px;
}

/* ===== Ø§Ù„Ø£Ø¯ÙˆØ§Øª ===== */
.controls {
    text-align: center;
    margin: 4px 0;
}

.controls button {
    padding: 3px 6px;
    margin: 2px;
    font-size: 10px;
    font-weight: bold;
    cursor: pointer;
}

/* ===== Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ (Ø§Ù„Ø¬Ø¯ÙˆÙ„) ===== */
.content {
    display: flex;
    flex-direction: column;
    justify-content: center; /* â¬…ï¸ ØªÙˆØ³ÙŠØ· Ø¹Ù…ÙˆØ¯ÙŠ */
}

/* ===== Ø§Ù„Ø¬Ø¯ÙˆÙ„ ===== */
table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;
}

th, td {
    border: 1px solid #000;
    font-size: 9.5px;
    font-weight: 600;
    height: 13px;
    text-align: center;
    padding: 0;
}

th {
    background: #eaeaea !important;
    font-size: 10px;
    font-weight: 700;
}

.num-col  { width: 5%; }
.name-col { width: 28%; }
.loc-col  { width: 27%; }
.sign-col { width: 40%; }

input, select {
    width: 100%;
    height: 100%;
    border: none;
    background: transparent;
    font-size: 9.5px;
    font-weight: 600;
    text-align: center;
}

/* ===== Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ ===== */
canvas {
    width: 100%;
    height: 18px;
    border: 1px dashed #000;
}

/* ===== Ø§Ù„Ø£Ù„ÙˆØ§Ù† ===== */
#morningTable tbody td { background: #fff6cc !important; }
#eveningTable tbody td { background: #e6f2ff !important; }

/* ===== Ø§Ù„ÙÙˆØªØ± ===== */
.footer {
    font-size: 10px;
}

.center-totals {
    text-align: center;
    font-weight: bold;
    margin: 3px 0;
}

.signatures {
    display: flex;
    justify-content: space-between;
    font-weight: bold;
}

/* ===== Ø·Ø¨Ø§Ø¹Ø© ===== */
@media print {
    .controls { display:none; }
}
</style>
</head>

<body>

<!-- ===== Ø§Ù„Ù‡ÙŠØ¯Ø± ===== -->
<div>
    <div class="header">
        <div class="logo-box"><img src="majdoul.png"></div>
        <div class="logo-box"><img src="linkexpert.png"></div>
    </div>
    <h2>Ø§Ù„ØªØ­Ø¶ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</h2>
    <div class="date" id="dateTime"></div>

    <div class="controls">
        <button onclick="window.print()">ğŸ–¨ï¸ PDF</button>
        <button onclick="exportExcel()">ğŸ“Š Excel</button>
        <button onclick="clearData()">ğŸ—‘ï¸ Ù…Ø³Ø­</button>
        <button onclick="setMode('morning')">â˜€ï¸ ØµØ¨Ø§Ø­</button>
        <button onclick="setMode('evening')">ğŸŒ™ Ù…Ø³Ø§Ø¡</button>
        <button onclick="setMode('all')">ğŸ“‹ ÙƒØ§Ù…Ù„</button>
        <button onclick="toggleDate()">ğŸ•’ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ®</button>
    </div>
</div>

<input type="datetime-local" id="customDate" onchange="applyDate()" style="display:none;">

<!-- ===== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ===== -->
<div class="content">

<h3 id="morningTitle">ØªØ­Ø¶ÙŠØ± Ø§Ù„ØµØ¨Ø§Ø­</h3>
<table id="morningTable">
<thead>
<tr>
<th class="num-col">#</th>
<th class="name-col">Ø§Ù„Ø§Ø³Ù…</th>
<th class="loc-col">Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
<th class="sign-col">Ø§Ù„ØªÙˆÙ‚ÙŠØ¹</th>
</tr>
</thead>
<tbody></tbody>
</table>

<h3 id="eveningTitle">ØªØ­Ø¶ÙŠØ± Ø§Ù„Ù…Ø³Ø§Ø¡</h3>
<table id="eveningTable">
<thead>
<tr>
<th class="num-col">#</th>
<th class="name-col">Ø§Ù„Ø§Ø³Ù…</th>
<th class="loc-col">Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
<th class="sign-col">Ø§Ù„ØªÙˆÙ‚ÙŠØ¹</th>
</tr>
</thead>
<tbody></tbody>
</table>

</div>

<!-- ===== Ø§Ù„ÙÙˆØªØ± ===== -->
<div class="footer">
    <div class="center-totals">
        ØµØ¨Ø§Ø­: <span id="morningTotal">0</span> |
        Ù…Ø³Ø§Ø¡: <span id="eveningTotal">0</span> |
        Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="grandTotal">0</span>
    </div>

    <div class="signatures">
        <div>Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©<br>Ø³Ù„Ù…Ø§Ù† Ø§Ù„Ø­Ù…ÙˆØ¯</div>
        <div>Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹<br>Ø³Ø§Ù„Ù… Ø§Ù„Ø´Ù…Ø±ÙŠ</div>
    </div>
</div>

<script>
const locations = `
<option value="">â€” Ø§Ø®ØªØ± â€”</option>
<option>Ù…ØªØ­Ø±Ùƒ</option>
<option>ØªØºØ·ÙŠØ§Øª</option>
<option>Ù…Ù†Ø¸Ù… Ù…ÙˆØ§Ù‚Ù P1</option>
<option>Ù…Ù†Ø¸Ù… Ù…ÙˆØ§Ù‚Ù P2</option>
<option>Ù…Ù†Ø¸Ù… Ù…ÙˆØ§Ù‚Ù P3</option>
<option>Ù…Ù†Ø¸Ù… Ù…ÙˆØ§Ù‚Ù P4</option>
<option>Ù…Ù†Ø¸Ù… Ø¨ÙˆØ§Ø¨Ø© 3</option>
<option>Ù…Ù†Ø¸Ù… Ø¨ÙˆØ§Ø¨Ø© 5</option>
<option>Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ø­Ù† A</option>
<option>Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ø­Ù† P2</option>
<option>ÙØ§Ù„ÙŠÙ‡ Ù¡</option>
<option>ÙØ§Ù„ÙŠÙ‡ Ù¢</option>
<option>ÙØ§Ù„ÙŠÙ‡ Ù£ - ÙØ­Øµ</option>
`;

function createRows(id,count){
    const tb=document.querySelector(`#${id} tbody`);
    for(let i=1;i<=count;i++){
        tb.innerHTML+=`
<tr>
<td>${i}</td>
<td><input oninput="calc()"></td>
<td><select onchange="calc()">${locations}</select></td>
<td><canvas></canvas></td>
</tr>`;
    }
    initCanvas();
}

function calc(){
    let m=0,e=0;
    document.querySelectorAll("#morningTable tbody tr").forEach(r=>{
        if(r.querySelector("input").value && r.querySelector("select").value) m++;
    });
    document.querySelectorAll("#eveningTable tbody tr").forEach(r=>{
        if(r.querySelector("input").value && r.querySelector("select").value) e++;
    });
    morningTotal.textContent=m;
    eveningTotal.textContent=e;
    grandTotal.textContent=m+e;
}

function setMode(mode){
    morningTable.style.display = (mode==="evening")?"none":"table";
    morningTitle.style.display = (mode==="evening")?"none":"block";
    eveningTable.style.display = (mode==="morning")?"none":"table";
    eveningTitle.style.display = (mode==="morning")?"none":"block";
}

function toggleDate(){
    customDate.style.display =
    customDate.style.display==="none"?"inline-block":"none";
}

function applyDate(){
    const d=new Date(customDate.value);
    dateTime.textContent=d.toLocaleString('en-GB',{
        weekday:'long',day:'2-digit',month:'long',year:'numeric',
        hour:'2-digit',minute:'2-digit'
    });
    customDate.style.display="none";
}

function exportExcel(){
    let csv="\uFEFFØ§Ù„ÙØªØ±Ø©,Ø§Ù„Ø±Ù‚Ù…,Ø§Ù„Ø§Ø³Ù…,Ø§Ù„Ù…ÙˆÙ‚Ø¹\n";
    document.querySelectorAll("#morningTable tbody tr").forEach((r,i)=>{
        csv+=`ØµØ¨Ø§Ø­,${i+1},${r.querySelector("input").value},${r.querySelector("select").value}\n`;
    });
    document.querySelectorAll("#eveningTable tbody tr").forEach((r,i)=>{
        csv+=`Ù…Ø³Ø§Ø¡,${i+1},${r.querySelector("input").value},${r.querySelector("select").value}\n`;
    });
    const blob=new Blob([csv],{type:"text/csv;charset=utf-8;"});
    const link=document.createElement("a");
    link.href=URL.createObjectURL(blob);
    link.download="attendance.csv";
    link.click();
}

function initCanvas(){
    document.querySelectorAll("canvas").forEach(c=>{
        const ctx=c.getContext("2d");
        let draw=false;
        c.onmousedown=()=>draw=true;
        c.onmouseup=()=>{draw=false;ctx.beginPath();}
        c.onmousemove=e=>{
            if(!draw) return;
            ctx.lineWidth=1;
            ctx.lineTo(e.offsetX,e.offsetY);
            ctx.stroke();
        };
    });
}

dateTime.textContent=new Date().toLocaleString('en-GB',{
weekday:'long',day:'2-digit',month:'long',year:'numeric',
hour:'2-digit',minute:'2-digit'
});

createRows("morningTable",19);
createRows("eveningTable",10);
calc();
</script>

</body>
</html>
