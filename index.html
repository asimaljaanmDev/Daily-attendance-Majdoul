<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</title>

<style>
body{font-family:Tahoma;background:#eaeaea;padding:20px}
.page{width:210mm;margin:auto;background:#fff;padding:15px;border:1px solid #bbb}

/* HEADER */
.header{
display:grid;
grid-template-columns:1fr 2fr 1fr;
align-items:center;
border-bottom:6px solid #c7a35a;
padding-bottom:10px
}
.header img{height:90px}
.center{text-align:center;font-weight:bold}

/* DATE DISPLAY */
#dateDisplay{margin-top:5px;font-size:14px;font-weight:normal}

/* TABLE */
table{width:100%;border-collapse:collapse;margin-top:15px;font-size:13px}
th,td{border:1px solid #000;padding:6px;text-align:center}
.morning th{background:#ffe699}
.evening th{background:#cfe2f3}
td.name{background:#fffbe6}

/* ROW COLORS */
tr.morning-filled{background:#fff2cc}
tr.evening-filled{background:#ddebf7}

/* COUNT */
.count-cell{background:#ffd966;font-weight:bold}

/* SUMMARY */
.summary{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:10px;
margin:20px 0
}
.box{border:1px solid #000;text-align:center;font-weight:bold;padding:10px}

/* FOOTER */
.footer{display:grid;grid-template-columns:1fr 1fr;margin-top:25px}
.signature{border:1px solid #000;padding:10px;height:70px;font-weight:bold}
.right{text-align:right}
.left{text-align:left}

/* BUTTONS */
.export-btn{
position:fixed;left:25px;padding:10px 20px;
font-weight:bold;border:none;border-radius:6px;cursor:pointer
}
.pdf{bottom:25px;background:#c7a35a}
.excel{bottom:70px;background:#4CAF50;color:#fff}

/* PRINT */
@page{size:A4;margin:12mm}
@media print{
.export-btn{display:none}
tr.empty{display:none}
#dateInput{display:none}
#dateDisplay{display:block}
}
</style>
</head>

<body>
<div class="page">

<!-- HEADER -->
<div class="header">
<img src="linkexpert.png">
<div class="center">
Ø´Ø±ÙƒØ© LINK EXPERT<br>
Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ<br>
<input type="date" id="dateInput" onchange="showDay()">
<div id="dateDisplay"></div>
</div>
<img src="majdoul.png">
</div>

<!-- MORNING -->
<table class="morning">
<tr><th>#</th><th>Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„ÙØªØ±Ø©</th></tr>
<script>
const morningJobs=[
"Ù…Ø¯ÙŠØ± Ø§Ù„Ù…ÙˆØ§Ù‚Ù","ØªØºØ·ÙŠØ§Øª","ØªØºØ·ÙŠØ§Øª","ÙØ§Ù„ÙŠÙ‡ 1","ÙØ§Ù„ÙŠÙ‡ 1","ÙØ§Ù„ÙŠÙ‡ 2",
"ÙØ§Ù„ÙŠÙ‡ 3 - ÙØ­Øµ","Ù…Ù†Ø¸Ù… Ø¨ÙˆØ§Ø¨Ø© 3","Ù…Ù†Ø¸Ù… Ø¨ÙˆØ§Ø¨Ø© 5",
"Ù…Ù†Ø¸Ù… Ù…ÙˆØ§Ù‚Ù P1","Ù…Ù†Ø¸Ù… Ù…ÙˆØ§Ù‚Ù P1","Ù…Ù†Ø¸Ù… Ù…ÙˆØ§Ù‚Ù P1",
"Ù…Ù†Ø¸Ù… Ù…ÙˆØ§Ù‚Ù P2","Ù…Ù†Ø¸Ù… Ù…ÙˆØ§Ù‚Ù P2","Ù…Ù†Ø¸Ù… Ù…ÙˆØ§Ù‚Ù P2",
"Ù…Ù†Ø¸Ù… Ù…ÙˆØ§Ù‚Ù P3","Ù…Ù†Ø¸Ù… Ù…ÙˆØ§Ù‚Ù P4",
"Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø´Ø­Ù† A","Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø´Ø­Ù† P2"
];
morningJobs.forEach((j,i)=>{
document.write(`<tr class="empty morning-row">
<td>${i+1}</td><td>${j}</td>
<td class="name morning-name" contenteditable></td><td>7Øµâ€“7Ù…</td>
</tr>`);
});
</script>
<tr><td colspan="3">ØµØ¨Ø§Ø­ (Ù…Ù† 19)</td><td class="count-cell" id="mCount">0</td></tr>
</table>

<!-- EVENING -->
<table class="evening">
<tr><th>#</th><th>Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„ÙØªØ±Ø©</th></tr>
<script>
const eveningJobs=[
"ØªØºØ·ÙŠØ§Øª","ÙØ§Ù„ÙŠÙ‡ 1","ÙØ§Ù„ÙŠÙ‡ 2","Ù…Ù†Ø¸Ù… Ø¨ÙˆØ§Ø¨Ø© 3","Ù…Ù†Ø¸Ù… Ø¨ÙˆØ§Ø¨Ø© 5",
"Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø´Ø­Ù† A","Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø´Ø­Ù† P2","Ù…Ù†Ø¸Ù… Ù…ÙˆØ§Ù‚Ù P1","Ù…Ù†Ø¸Ù… Ù…ÙˆØ§Ù‚Ù P3"
];
eveningJobs.forEach((j,i)=>{
document.write(`<tr class="empty evening-row">
<td>${i+1}</td><td>${j}</td>
<td class="name evening-name" contenteditable></td><td>7Ù…â€“7Øµ</td>
</tr>`);
});
</script>
<tr><td colspan="3">Ù…Ø³Ø§Ø¡ (Ù…Ù† 9)</td><td class="count-cell" id="eCount">0</td></tr>
</table>

<!-- SUMMARY -->
<div class="summary">
<div class="box">ØµØ¨Ø§Ø­<br><span id="sm">0 / 19</span></div>
<div class="box">Ù…Ø³Ø§Ø¡<br><span id="se">0 / 9</span></div>
<div class="box">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹<br><span id="st">0 / 28</span></div>
</div>

<!-- FOOTER -->
<div class="footer">
<div class="signature right">Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©<br>Ø³Ù„Ù…Ø§Ù† Ø§Ù„Ø­Ù…ÙˆØ¯</div>
<div class="signature left">Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹<br>Ø³Ø§Ù„Ù… Ø§Ù„Ø´Ù…Ø±ÙŠ</div>
</div>

</div>

<!-- BUTTONS -->
<button class="export-btn pdf" onclick="window.print()">ğŸ“„ PDF</button>
<button class="export-btn excel" onclick="exportExcel()">ğŸ“Š Excel</button>

<script>
// ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø§Ø³Ù…
function cleanName(txt){return txt.replace(/\s+/g,' ').trim();}

// Ø§Ù„ØªØ§Ø±ÙŠØ®
function showDay(){
    const input=document.getElementById("dateInput");
    const display=document.getElementById("dateDisplay");
    if(!input.value){ display.innerText=""; return; }
    const date=new Date(input.value);
    const days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
    const months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
    display.innerText=`${days[date.getDay()]} ${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear()}`;
}

// Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹
function calc(){
    const morningCells=Array.from(document.querySelectorAll('.morning-name'));
    const eveningCells=Array.from(document.querySelectorAll('.evening-name'));

    const m=morningCells.filter(c=>cleanName(c.innerText)!=="").length;
    const e=eveningCells.filter(c=>cleanName(c.innerText)!=="").length;

    document.getElementById("mCount").innerText=m;
    document.getElementById("eCount").innerText=e;
    document.getElementById("sm").innerText=`${m} / 19`;
    document.getElementById("se").innerText=`${e} / 9`;
    document.getElementById("st").innerText=`${m+e} / 28`;
}

// Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø± ÙˆØªÙ„ÙˆÙŠÙ† Ø§Ù„ØµÙÙˆÙ
document.querySelectorAll('.name').forEach(cell=>{
    cell.addEventListener('input',()=>{
        const row=cell.closest('tr');
        const name=cleanName(cell.innerText);

        if(name){
            const names=Array.from(document.querySelectorAll('.name'))
                .map(c=>cleanName(c.innerText)).filter(n=>n!=="");
            if(names.filter(n=>n===name).length>1){
                alert("âš ï¸ Ø§Ù„Ø§Ø³Ù… Ù…ÙƒØ±Ø±");
                cell.innerText="";
                row.classList.remove('morning-filled','evening-filled');
                row.classList.add('empty');
                calc();
                return;
            }

            row.classList.remove('empty','morning-filled','evening-filled');
            if(cell.classList.contains('morning-name')) row.classList.add('morning-filled');
            if(cell.classList.contains('evening-name')) row.classList.add('evening-filled');

        } else {
            row.classList.remove('morning-filled','evening-filled');
            row.classList.add('empty');
        }

        calc();
    });
});

// Excel CSV
function exportExcel(){
    let rows=[];
    document.querySelectorAll("table tr").forEach(tr=>{
        if(tr.classList.contains("empty")) return;
        rows.push([...tr.children].map(td=>`"${td.innerText.trim()}"`).join(","));
    });
    const blob=new Blob(["\ufeff"+rows.join("\n")],{type:"text/csv;charset=utf-8"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="attendance.csv";
    a.click();
}
</script>

</body>
</html>
